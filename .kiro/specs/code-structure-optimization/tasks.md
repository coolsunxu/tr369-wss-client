# 代码目录结构优化实施计划

- [x] 1. 创建新的目录结构框架


  - 创建符合清洁架构的完整目录结构
  - 设置各层级的基础目录和文件
  - 配置 Go 模块和包结构
  - _需求: 1.1, 2.1, 2.2, 2.3_

- [x] 1.1 编写目录结构验证属性测试


  - **属性 6: 目录结构一致性**



  - **验证需求: 需求 2.3**

- [x] 2. 定义领域层核心接口

  - 创建 TR181 仓储接口定义
  - 定义消息处理服务接口
  - 实现领域实体和值对象


  - 建立领域层的错误类型
  - _需求: 3.1, 3.3, 1.2_





- [x] 2.1 编写接口定义位置属性测试


  - **属性 9: 业务接口领域层定位**
  - **验证需求: 需求 3.1**


- [x] 2.2 编写依赖倒置原则属性测试

  - **属性 1: 依赖倒置原则遵循**


  - **验证需求: 需求 1.2**



- [x] 3. 实现领域实体和值对象


  - 迁移 TR181 数据模型到领域层
  - 创建 USP 消息实体
  - 实现端点标识符值对象
  - 定义订阅和监听器实体


  - _需求: 1.1, 3.1_



- [x] 3.1 编写实体验证属性测试


  - **属性 12: 接口模拟测试支持**
  - **验证需求: 需求 3.4**


- [x] 4. 重构应用层用例

  - 创建连接管理用例
  - 实现 TR181 参数操作用例

  - 建立消息处理用例
  - 设置订阅管理用例
  - _需求: 1.1, 6.1, 6.2_


- [x] 4.1 编写用例独立性属性测试

  - **属性 22: 模块独立开发支持**

  - **验证需求: 需求 6.1**



- [x] 4.2 编写模块依赖接口化属性测试

  - **属性 23: 模块依赖接口化**
  - **验证需求: 需求 6.2**

- [x] 5. 迁移基础设施层实现


  - 重构 WebSocket 客户端实现
  - 迁移数据持久化层

  - 重组配置管理模块
  - 更新日志记录实现
  - _需求: 1.3, 1.4, 3.2_


- [x] 5.1 编写基础设施层隔离属性测试

  - **属性 2: 基础设施层隔离性**
  - **验证需求: 需求 1.3**

- [x] 5.2 编写外部依赖隔离属性测试


  - **属性 3: 外部依赖隔离**
  - **验证需求: 需求 1.4**




- [x] 5.3 编写外部服务实现位置属性测试
  - **属性 10: 外部服务实现基础设施层定位**
  - **验证需求: 需求 3.2**


- [x] 6. 重组公共库和工具代码

  - 迁移通用工具到 pkg 目录
  - 重构 Protocol Buffers 处理代码
  - 整理错误定义和处理
  - 优化字符串和加密工具
  - _需求: 2.4, 2.5_

- [x] 6.1 编写共享代码组织属性测试

  - **属性 8: 共享代码位置规范**
  - **验证需求: 需求 2.5**



- [x] 6.2 编写配置代码集中性属性测试

  - **属性 7: 配置代码集中性**
  - **验证需求: 需求 2.4**



- [x] 7. 更新接口层和入口点
  - 重构 main.go 入口点

  - 创建 CLI 命令结构
  - 更新 WebSocket 接口适配器

  - 建立依赖注入容器
  - _需求: 1.5, 3.3_


- [x] 7.1 编写跨层调用接口化属性测试
  - **属性 4: 跨层调用接口化**
  - **验证需求: 需求 1.5**



- [x] 7.2 编写模块间接口通信属性测试
  - **属性 11: 模块间接口通信**
  - **验证需求: 需求 3.3**


- [x] 8. 重组测试代码结构


  - 将单元测试文件移动到源文件同目录

  - 创建集成测试目录结构
  - 建立测试数据和模拟对象管理
  - 设置测试工具和辅助代码

  - _需求: 4.1, 4.2, 4.3, 4.5_



- [ ] 8.1 编写测试文件组织属性测试
  - **属性 14: 测试文件同目录组织**
  - **验证需求: 需求 4.1**


- [ ] 8.2 编写集成测试目录属性测试
  - **属性 15: 集成测试专门目录**
  - **验证需求: 需求 4.2**



- [ ] 8.3 编写测试数据管理属性测试
  - **属性 16: 测试数据统一管理**

  - **验证需求: 需求 4.3**

- [x] 8.4 编写测试工具组织属性测试



  - **属性 17: 测试工具独立组织**
  - **验证需求: 需求 4.5**


- [ ] 9. 配置和文档重组
  - 按环境分离配置文件
  - 重组项目文档结构

  - 创建部署配置和脚本
  - 分离生成代码和示例代码
  - _需求: 5.1, 5.2, 5.3, 5.4, 5.5_


- [ ] 9.1 编写环境配置分离属性测试
  - **属性 18: 环境配置分离**

  - **验证需求: 需求 5.1**




- [x] 9.2 编写文档组织属性测试

  - **属性 19: 文档类型化组织**
  - **验证需求: 需求 5.2**


- [ ] 9.3 编写生成代码分离属性测试
  - **属性 20: 生成代码分离**
  - **验证需求: 需求 5.4**





- [ ] 9.4 编写示例代码管理属性测试
  - **属性 21: 示例代码独立管理**
  - **验证需求: 需求 5.5**




- [ ] 10. 实现模块化支持
  - 确保各模块可独立编译
  - 建立模块边界和封装机制

  - 实现模块级配置管理
  - 设置模块独立测试能力






  - _需求: 6.1, 6.3, 6.4, 6.5_

- [ ] 10.1 编写模块边界封装属性测试
  - **属性 24: 模块边界封装性**
  - **验证需求: 需求 6.3**


- [ ] 10.2 编写模块独立测试属性测试
  - **属性 25: 模块独立测试能力**
  - **验证需求: 需求 6.4**


- [x] 10.3 编写模块配置独立性属性测试


  - **属性 26: 模块配置独立性**


  - **验证需求: 需求 6.5**

- [ ] 11. 建立架构验证机制
  - 创建静态分析工具配置
  - 实现架构约束检查


  - 设置持续集成验证
  - 建立代码质量门禁
  - _需求: 1.2, 1.3, 1.4, 1.5_

- [x] 11.1 编写接口向后兼容性属性测试


  - **属性 13: 接口向后兼容性**
  - **验证需求: 需求 3.5**

- [ ] 11.2 编写功能模块内聚性属性测试
  - **属性 5: 功能模块内聚性**


  - **验证需求: 需求 2.2**

- [ ] 12. 第一阶段检查点 - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户

- [ ] 13. 更新构建和部署脚本
  - 更新 Go 模块依赖
  - 修改构建脚本适应新结构
  - 更新测试运行脚本
  - 调整部署配置
  - _需求: 5.3_

- [ ] 14. 创建迁移文档和指南
  - 编写架构迁移指南
  - 创建开发者使用文档
  - 建立最佳实践指南
  - 提供故障排除文档
  - _需求: 5.2_

- [ ] 15. 验证功能完整性
  - 运行完整的回归测试
  - 验证所有原有功能正常
  - 检查性能影响
  - 确认向后兼容性
  - _需求: 3.5_

- [ ] 16. 最终检查点 - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户